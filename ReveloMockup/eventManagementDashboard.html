<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revelo - Event Management</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Nunito -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Your Custom Stylesheet -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100 antialiased text-gray-800 pt-16">
    <!-- Organizer-specific Navbar -->
    <div id="organizer-navbar-placeholder"></div>

    <!-- Main container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Header Section -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-6">
            <div>
                <div class="flex items-center">
                    <h1 class="text-3xl font-extrabold revelo-blue">Sensuality & Essentiality</h1>
                    <span class="ml-4 text-sm font-bold bg-green-100 text-green-800 px-3 py-1 rounded-full whitespace-nowrap">On Sale</span>
                </div>
                <p class="text-gray-600">Event Management Dashboard</p>
            </div>
            <div class="flex space-x-2 mt-4 md:mt-0">
                <a href="eventDetail.html" class="px-4 py-2 font-semibold bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-300">View Public Page</a>
                <a href="#" class="px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg hover:bg-blue-800 transition duration-300">Live Edit Page</a>
            </div>
        </header>
        
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <!-- Tab Navigation -->
            <nav class="border-b border-gray-200">
                <div class="flex">
                    <button onclick="switchTab('overview')" class="tab-button flex-1 py-4 px-1 text-center text-gray-500 hover:revelo-blue font-semibold transition duration-300 organizer-tab-active">Overview</button>
                    <button onclick="switchTab('tickets')" class="tab-button flex-1 py-4 px-1 text-center text-gray-500 hover:revelo-blue font-semibold transition duration-300">Ticket Management</button>
                    <button onclick="switchTab('analytics')" class="tab-button flex-1 py-4 px-1 text-center text-gray-500 hover:revelo-blue font-semibold transition duration-300">Analytics</button>
                    <button onclick="switchTab('media')" class="tab-button flex-1 py-4 px-1 text-center text-gray-500 hover:revelo-blue font-semibold transition duration-300">Media Gallery</button>
                    <button onclick="switchTab('collaborators')" class="tab-button flex-1 py-4 px-1 text-center text-gray-500 hover:revelo-blue font-semibold transition duration-300">Collaborators</button>
                </div>
            </nav>

            <!-- Main Content Sections (Tabs) -->
            <main class="p-6 md:p-8">
                <!-- Overview Tab -->
                <div id="overview" class="tab-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-sm font-semibold text-gray-500 uppercase">Gross Revenue</h3><p class="text-3xl font-extrabold revelo-blue mt-2">€51,950</p></div>
                        <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-sm font-semibold text-gray-500 uppercase">Tickets Sold</h3><p class="text-3xl font-extrabold revelo-blue mt-2">357 / 500</p></div>
                        <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-sm font-semibold text-gray-500 uppercase">Page Views</h3><p class="text-3xl font-extrabold revelo-blue mt-2">14,820</p></div>
                        <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-sm font-semibold text-gray-500 uppercase">Live Check-ins</h3><p class="text-3xl font-extrabold text-gray-400 mt-2">N/A</p></div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
                        <div class="lg:col-span-2 bg-gray-50 p-6 rounded-lg border">
                            <h3 class="font-bold revelo-blue mb-4">Sales Over Time</h3>
                            <canvas id="salesChart"></canvas>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="font-bold revelo-blue mb-4">Recent Activity</h3>
                            <ul class="space-y-3 text-sm">
                                <li class="flex items-center"><span class="bg-green-500 w-2 h-2 rounded-full mr-3"></span>New sale: Full Pass by Alex J.</li>
                                <li class="flex items-center"><span class="bg-blue-500 w-2 h-2 rounded-full mr-3"></span>DJ Sparkus's promo code used.</li>
                                <li class="flex items-center"><span class="bg-purple-500 w-2 h-2 rounded-full mr-3"></span>AMedia published 'Workshops' gallery.</li>
                                <li class="flex items-center"><span class="bg-green-500 w-2 h-2 rounded-full mr-3"></span>New sale: Party Pass by Maria G.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Ticket Management Tab -->
                <div id="tickets" class="tab-content hidden space-y-8">
                    <!-- Ticket Types Section -->
                    <details open><summary class="flex justify-between items-center cursor-pointer font-bold text-xl revelo-blue">Ticket Types <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></summary>
                        <div class="mt-4">
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white border">
                                    <thead class="bg-gray-50"><tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Price</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Sold</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th><th class="px-4 py-2"></th></tr></thead>
                                    <tbody id="ticket-types-table" class="divide-y divide-gray-200">
                                        <tr><td class="px-4 py-3 whitespace-nowrap font-semibold">Sensuality Pass</td><td class="px-4 py-3">€190.00</td><td class="px-4 py-3">150 / 200</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-green-100 text-green-800 px-2 py-1 rounded-full">On Sale</span></td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-ticket-modal', this)" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                        <tr><td class="px-4 py-3 whitespace-nowrap font-semibold">Essentiality Pass</td><td class="px-4 py-3">€190.00</td><td class="px-4 py-3">120 / 200</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-green-100 text-green-800 px-2 py-1 rounded-full">On Sale</span></td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-ticket-modal', this)" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                        <tr><td class="px-4 py-3 whitespace-nowrap font-semibold">J&J Amateur</td><td class="px-4 py-3">€10.00</td><td class="px-4 py-3">17 / 20</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">Low Stock</span></td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-ticket-modal', this)" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                        <tr><td class="px-4 py-3 whitespace-nowrap font-semibold">Training Tracks</td><td class="px-4 py-3">€100.00</td><td class="px-4 py-3">0 / 50</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Draft</span></td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-ticket-modal', this)" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                        <tr class="opacity-60"><td class="px-4 py-3 whitespace-nowrap font-semibold">Sensuality Pass</td><td class="px-4 py-3">€180.00</td><td class="px-4 py-3">50 / 50</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Finished</span></td><td class="px-4 py-3 text-right"></td></tr>
                                        <tr class="opacity-60"><td class="px-4 py-3 whitespace-nowrap font-semibold">Essentiality Pass</td><td class="px-4 py-3">€180.00</td><td class="px-4 py-3">40 / 40</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Finished</span></td><td class="px-4 py-3 text-right"></td></tr>
                                        <tr class="opacity-60"><td class="px-4 py-3 whitespace-nowrap font-semibold">Sensuality Pass</td><td class="px-4 py-3">€170.00</td><td class="px-4 py-3">50 / 50</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Finished</span></td><td class="px-4 py-3 text-right"></td></tr>
                                        <tr class="opacity-60"><td class="px-4 py-3 whitespace-nowrap font-semibold">Essentiality Pass</td><td class="px-4 py-3">€170.00</td><td class="px-4 py-3">30 / 30</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Finished</span></td><td class="px-4 py-3 text-right"></td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <button onclick="openModal('create-ticket-modal')" class="w-full md:w-auto mt-4 px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg hover:bg-blue-800">Create New Ticket Type</button>
                        </div>
                    </details>
                    <!-- Discount Codes Section -->
                    <details><summary class="flex justify-between items-center cursor-pointer font-bold text-xl revelo-blue">Discount Codes <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></summary>
                        <div class="mt-4">
                             <div class="overflow-x-auto">
                                <table class="min-w-full bg-white border">
                                    <thead class="bg-gray-50"><tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Code</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Discount</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Uses</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Promoter</th><th class="px-4 py-2"></th></tr></thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <tr><td class="px-4 py-3 whitespace-nowrap font-semibold">DJSPARKUS10</td><td class="px-4 py-3">10%</td><td class="px-4 py-3">45 / 100</td><td class="px-4 py-3">DJ Sparkus</td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-code-modal')" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                        <tr><td class="px-4 py-3 whitespace-nowrap font-semibold">VALENTINES</td><td class="px-4 py-3">€5.00</td><td class="px-4 py-3">25 / 150</td><td class="px-4 py-3">Bachata Sensual Events</td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-code-modal')" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                        <tr><td class="px-4 py-3 whitespace-nowrap font-semibold">DOE</td><td class="px-4 py-3">10%</td><td class="px-4 py-3">12 / 50</td><td class="px-4 py-3">John Doe</td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-code-modal')" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <button onclick="openModal('create-code-modal')" class="w-full md:w-auto mt-4 px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg hover:bg-blue-800">Generate New Code</button>
                        </div>
                    </details>
                    <!-- Dynamic Pricing Section -->
                    <details><summary class="flex justify-between items-center cursor-pointer font-bold text-xl revelo-blue">Dynamic Pricing <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></summary>
                        <div class="mt-4">
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white border">
                                    <thead class="bg-gray-50"><tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Rule</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ticket Type</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Sold</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th><th class="px-4 py-2"></th></tr></thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <tr><td class="px-4 py-3">Increase price to <b>€15.00</b> after <b>20</b> sales</td><td class="px-4 py-3">J&J Amateur</td><td class="px-4 py-3">17 / 20</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-green-100 text-green-800 px-2 py-1 rounded-full">Active</span></td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-rule-modal', this)" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                        <tr><td class="px-4 py-3">Increase price to <b>€20.00</b> after <b>40</b> sales</td><td class="px-4 py-3">J&J Amateur</td><td class="px-4 py-3">17 / 40</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Pending</span></td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-rule-modal', this)" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                        <tr><td class="px-4 py-3">Increase price to <b>€220.00</b> on <b>Sep 1, 2025</b></td><td class="px-4 py-3">Sensuality Pass</td><td class="px-4 py-3">-</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-green-100 text-green-800 px-2 py-1 rounded-full">Active</span></td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-rule-modal', this)" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                        <tr><td class="px-4 py-3">Increase price to <b>€220.00</b> on <b>Sep 1, 2025</b></td><td class="px-4 py-3">Essentiality Pass</td><td class="px-4 py-3">-</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-green-100 text-green-800 px-2 py-1 rounded-full">Active</span></td><td class="px-4 py-3 text-right"><button onclick="openModal('edit-rule-modal', this)" class="text-sm font-semibold revelo-blue">Edit</button></td></tr>
                                        <tr class="opacity-60"><td class="px-4 py-3">Increase price to <b>€190.00</b> on <b>Aug 1, 2025</b></td><td class="px-4 py-3">Sensuality Pass</td><td class="px-4 py-3">50 / 50</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Finished</span></td><td class="px-4 py-3 text-right"><button class="text-sm font-semibold text-gray-400 cursor-not-allowed">Edit</button></td></tr>
                                        <tr class="opacity-60"><td class="px-4 py-3">Increase price to <b>€190.00</b> on <b>Aug 1, 2025</b></td><td class="px-4 py-3">Essentiality Pass</td><td class="px-4 py-3">40 / 40</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Finished</span></td><td class="px-4 py-3 text-right"><button class="text-sm font-semibold text-gray-400 cursor-not-allowed">Edit</button></td></tr>
                                        <tr class="opacity-60"><td class="px-4 py-3">Increase price to <b>€180.00</b> on <b>Jul 1, 2025</b></td><td class="px-4 py-3">Sensuality Pass</td><td class="px-4 py-3">50 / 50</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Finished</span></td><td class="px-4 py-3 text-right"><button class="text-sm font-semibold text-gray-400 cursor-not-allowed">Edit</button></td></tr>
                                        <tr class="opacity-60"><td class="px-4 py-3">Increase price to <b>€180.00</b> on <b>Jul 1, 2025</b></td><td class="px-4 py-3">Essentiality Pass</td><td class="px-4 py-3">30 / 30</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Finished</span></td><td class="px-4 py-3 text-right"><button class="text-sm font-semibold text-gray-400 cursor-not-allowed">Edit</button></td></tr>
                                        <tr class="opacity-60"><td class="px-4 py-3">Increase price to <b>€170.00</b> on <b>Jun 1, 2025</b></td><td class="px-4 py-3">Sensuality Pass</td><td class="px-4 py-3">50 / 50</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Finished</span></td><td class="px-4 py-3 text-right"><button class="text-sm font-semibold text-gray-400 cursor-not-allowed">Edit</button></td></tr>
                                        <tr class="opacity-60"><td class="px-4 py-3">Increase price to <b>€170.00</b> on <b>Jun 1, 2025</b></td><td class="px-4 py-3">Essentiality Pass</td><td class="px-4 py-3">50 / 50</td><td class="px-4 py-3"><span class="text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full">Finished</span></td><td class="px-4 py-3 text-right"><button class="text-sm font-semibold text-gray-400 cursor-not-allowed">Edit</button></td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <button onclick="openModal('create-rule-modal')" class="w-full md:w-auto mt-4 px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg hover:bg-blue-800">Create New Rule</button>
                        </div>
                    </details>
                </div>

                <!-- Analytics Tab -->
                <div id="analytics" class="tab-content hidden">
                    <p class="text-gray-600">View detailed sales charts, track promoter performance, and export attendee data.</p>
                </div>

                <!-- Media Gallery Tab -->
                <div id="media" class="tab-content hidden">
                    <!-- Header and Main Actions -->
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                        <div>
                            <h2 class="font-bold text-2xl revelo-blue">Media Management</h2>
                            <p class="text-gray-600">Manage all official media for <strong>Sensuality & Essentiality</strong>.</p>
                        </div>
                        <div class="flex space-x-2 mt-4 md:mt-0">
                            <button class="px-4 py-2 font-semibold bg-gray-200 text-gray-700 rounded-lg">Upload Media</button>
                            <button class="px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg">Create New Gallery</button>
                        </div>
                    </div>

                    <!-- Two-Panel Layout -->
                    <div class="flex flex-col md:flex-row md:space-x-8">
                        <!-- Left Sidebar: Tree View -->
                        <aside class="w-full md:w-1/4 lg:w-1/5 border rounded-lg p-4 bg-gray-50 mb-6 md:mb-0">
                            <h3 class="font-bold revelo-blue mb-2">Gallery Folders</h3>
                            <ul id="gallery-tree" class="space-y-1">
                                <!-- Tree items will be generated by JS -->
                            </ul>
                        </aside>

                        <!-- Right Panel: Grid View -->
                        <div class="flex-1">
                            <!-- Breadcrumb Navigation -->
                            <nav id="breadcrumb-nav" class="mb-4 text-sm text-gray-500"></nav>

                            <!-- Current Folder Actions -->
                            <div id="current-folder-actions" class="mb-6 p-4 border rounded-lg bg-gray-50">
                                <!-- Folder info will be generated by JS -->
                            </div>
                            
                            <!-- Gallery Grid -->
                            <div id="gallery-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                <!-- Gallery cards will be generated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Collaborators Tab -->
                <div id="collaborators" class="tab-content hidden">
                    <p class="text-gray-600">Manage your event team, including creators and promoters. Invite new members and set permissions.</p>
                </div>
            </main>
        </div>
    </div>

    <!-- Edit Folder Modal -->
    <div id="edit-folder-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 space-y-4">
            <h3 class="font-bold text-xl revelo-blue" id="modal-folder-name">Edit Folder: Sensuality 2025</h3>
            <!-- Status -->
            <div>
                <label class="font-semibold text-gray-700">Status</label>
                <select id="modal-folder-status" onchange="toggleScheduledFields()" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                    <option>Private</option>
                    <option>Public</option>
                    <option>Scheduled</option>
                </select>
            </div>
            <!-- Scheduled Fields -->
            <div id="modal-scheduled-fields" class="hidden grid grid-cols-2 gap-4">
                <div>
                    <label class="font-semibold text-gray-700">Publish Date</label>
                    <input type="date" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                </div>
                <div>
                    <label class="font-semibold text-gray-700">Publish Time</label>
                    <input type="time" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                </div>
            </div>
            <!-- Collaborators -->
            <div>
                <label class="font-semibold text-gray-700">Collaborators</label>
                <div id="modal-collaborators-list" class="flex flex-wrap gap-2 mt-2">
                    <!-- Collaborator tags will be added here -->
                </div>
                <div class="relative mt-2">
                    <input type="text" id="modal-collaborator-search" onkeyup="handleModalSearch(event)" placeholder="Search to add a creator..." class="w-full p-2 border border-gray-300 rounded-md">
                    <div id="modal-search-suggestions" class="absolute w-full bg-white border border-gray-300 rounded-md mt-1 shadow-lg z-20 hidden"></div>
                </div>
            </div>
            <div class="flex justify-end space-x-2 border-t pt-4">
                <button onclick="closeAllModals()" class="px-4 py-2 font-semibold bg-gray-200 text-gray-700 rounded-lg">Cancel</button>
                <button onclick="alert('Simulating: Folder Saved!'); closeAllModals();" class="px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div id="lightbox-modal" class="modal fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 hidden z-50">
        <img id="lightbox-image" src="" class="max-h-full max-w-full object-contain">
        <div class="absolute top-0 right-0 p-4 flex items-center space-x-2 text-white">
            <button id="privacy-toggle" class="p-2 rounded-full hover:bg-white/20" title="Toggle Privacy">
                <!-- Eye icon will be toggled here -->
            </button>
            <button class="p-2 rounded-full hover:bg-white/20" title="Delete Photo">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
            <button onclick="closeAllModals()" class="p-2 rounded-full hover:bg-white/20 text-3xl leading-none">&times;</button>
        </div>
    </div>

    <!-- Modals for Ticket Management -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40"></div>
    
    <!-- Create Ticket Modal -->
    <div id="create-ticket-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 space-y-4">
            <h3 class="font-bold text-xl revelo-blue">Create New Ticket Type</h3>
            <div><label class="font-semibold text-gray-700">Ticket Name</label><input id="new-ticket-name" type="text" placeholder="e.g., Weekend Pass" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="font-semibold text-gray-700">Price (€)</label><input id="new-ticket-price" type="number" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
                <div><label class="font-semibold text-gray-700">Quantity Available</label><input id="new-ticket-qty" type="number" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
            </div>
            <div><label class="font-semibold text-gray-700">Status</label><select id="new-ticket-status" class="w-full p-2 border border-gray-300 rounded-md mt-1"><option>On Sale</option><option>Draft</option><option>Scheduled</option><option>Dynamic</option></select></div>
            <div class="flex justify-end space-x-2">
                <button onclick="closeAllModals()" class="px-4 py-2 font-semibold bg-gray-200 text-gray-700 rounded-lg">Cancel</button>
                <button onclick="addTicket()" class="px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg">Save Ticket</button>
            </div>
        </div>
    </div>
    <!-- Edit Ticket Modal -->
    <div id="edit-ticket-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 space-y-4">
            <h3 class="font-bold text-xl revelo-blue">Edit Ticket Type</h3>
            <div id="edit-ticket-note" class="text-sm bg-yellow-100 text-yellow-800 p-3 rounded-lg hidden">For active tickets, only the quantity is editable to ensure consistency for existing buyers.</div>
            <div><label class="font-semibold text-gray-700">Ticket Name</label><input id="edit-ticket-name" type="text" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="font-semibold text-gray-700">Price (€)</label><input id="edit-ticket-price" type="number" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
                <div><label class="font-semibold text-gray-700">Quantity Available</label><input id="edit-ticket-qty" type="number" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
            </div>
            <div><label class="font-semibold text-gray-700">Status</label><select id="edit-ticket-status" class="w-full p-2 border border-gray-300 rounded-md mt-1"><option>On Sale</option><option>Draft</option><option>Scheduled</option><option>Dynamic</option></select></div>
            <div class="flex justify-between">
                <button id="delete-ticket-btn" onclick="alert('Simulating: Ticket Deleted!'); closeAllModals();" class="px-4 py-2 font-bold bg-red-600 text-white rounded-lg">Delete</button>
                <div class="flex space-x-2">
                    <button onclick="closeAllModals()" class="px-4 py-2 font-semibold bg-gray-200 text-gray-700 rounded-lg">Cancel</button>
                    <button onclick="alert('Simulating: Ticket Saved!'); closeAllModals();" class="px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Create/Edit Code Modal -->
    <div id="create-code-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 space-y-4">
            <h3 class="font-bold text-xl revelo-blue">Generate New Discount Code</h3>
            <div><label class="font-semibold text-gray-700">Discount Code</label><input type="text" placeholder="e.g., EARLYBIRD15" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="font-semibold text-gray-700">Discount Type</label><select class="w-full p-2 border border-gray-300 rounded-md mt-1"><option>Percentage (%)</option><option>Fixed Amount (€)</option></select></div>
                <div><label class="font-semibold text-gray-700">Value</label><input type="number" placeholder="15" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
            </div>
            <div><label class="font-semibold text-gray-700">Number of Uses</label><input type="number" placeholder="100" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
            <div class="flex justify-end space-x-2">
                <button onclick="closeAllModals()" class="px-4 py-2 font-semibold bg-gray-200 text-gray-700 rounded-lg">Cancel</button>
                <button onclick="alert('Simulating: Code Generated!'); closeAllModals();" class="px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg">Generate Code</button>
            </div>
        </div>
    </div>
     <!-- Edit Code Modal -->
    <div id="edit-code-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 space-y-4">
            <h3 class="font-bold text-xl revelo-blue">Edit Discount Code</h3>
            <div id="edit-code-note" class="text-sm bg-yellow-100 text-yellow-800 p-3 rounded-lg">For active codes, only the number of uses is editable.</div>
            <div><label class="font-semibold text-gray-700">Discount Code</label><input id="edit-code-name" type="text" value="DJSPARKUS10" class="w-full p-2 border border-gray-300 rounded-md mt-1" disabled></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="font-semibold text-gray-700">Discount Type</label><select id="edit-code-type" class="w-full p-2 border border-gray-300 rounded-md mt-1" disabled><option selected>Percentage (%)</option><option>Fixed Amount (€)</option></select></div>
                <div><label class="font-semibold text-gray-700">Value</label><input id="edit-code-value" type="number" value="10" class="w-full p-2 border border-gray-300 rounded-md mt-1" disabled></div>
            </div>
            <div><label class="font-semibold text-gray-700">Number of Uses</label><input id="edit-code-uses" type="number" value="100" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
            <div class="flex justify-end space-x-2">
                <button onclick="closeAllModals()" class="px-4 py-2 font-semibold bg-gray-200 text-gray-700 rounded-lg">Cancel</button>
                <button onclick="alert('Simulating: Code Saved!'); closeAllModals();" class="px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg">Save Changes</button>
            </div>
        </div>
    </div>
    <!-- Create/Edit Rule Modal -->
    <div id="create-rule-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 space-y-4">
            <h3 class="font-bold text-xl revelo-blue">Create New Pricing Rule</h3>
            <div><label class="font-semibold text-gray-700">Rule Type</label><select class="w-full p-2 border border-gray-300 rounded-md mt-1"><option>Increase price after X sales</option><option>Increase price on a specific date</option></select></div>
            <p>This is a simplified simulation. More fields would appear based on the rule type selected.</p>
            <div class="flex justify-end space-x-2">
                <button onclick="closeAllModals()" class="px-4 py-2 font-semibold bg-gray-200 text-gray-700 rounded-lg">Cancel</button>
                <button onclick="alert('Simulating: Rule Created!'); closeAllModals();" class="px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg">Create Rule</button>
            </div>
        </div>
    </div>
     <!-- Edit Rule Modal -->
    <div id="edit-rule-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 space-y-4">
            <h3 class="font-bold text-xl revelo-blue">Edit Pricing Rule</h3>
            <div id="edit-rule-note" class="text-sm bg-yellow-100 text-yellow-800 p-3 rounded-lg hidden">Active rules cannot be changed. Please create a new rule instead.</div>
            <div><label class="font-semibold text-gray-700">Rule Description</label><input id="edit-rule-desc" type="text" class="w-full p-2 border border-gray-300 rounded-md mt-1"></div>
            <div class="flex justify-between">
                <button id="delete-rule-btn" onclick="alert('Simulating: Rule Deleted!'); closeAllModals();" class="px-4 py-2 font-bold bg-red-600 text-white rounded-lg">Delete</button>
                <div class="flex space-x-2">
                    <button onclick="closeAllModals()" class="px-4 py-2 font-semibold bg-gray-200 text-gray-700 rounded-lg">Cancel</button>
                    <button id="save-rule-btn" onclick="alert('Simulating: Rule Saved!'); closeAllModals();" class="px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg">Save Changes</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        const galleryData = {
            id: 'root',
            name: 'Sensuality 2025',
            status: 'Public',
            creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }],
            children: [
                {
                    id: 'sat',
                    name: 'Saturday 01-Nov',
                    status: 'Public',
                    creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }],
                    children: [
                        {
                            id: 'sat-photos',
                            name: 'Photos',
                            status: 'Public',
                            creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }],
                            children: [
                                { id: 'workshops', name: 'Workshops', type: 'gallery', status: 'Public', creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }, { name: 'Lutty Moreira', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=LM' }], content: '125 Photos, 10 Videos' },
                                { id: 'jandj', name: 'Jack & Jill', type: 'gallery', status: 'Public', creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }], content: '50 Photos' },
                            ]
                        },
                        { id: 'sat-videos', name: 'Videos', status: 'Approval Needed', creators: [{ name: 'AMedia', avatar: 'https://placehold.20/ffffff?text=A' }], children: [] }
                    ]
                },
                {
                    id: 'sun',
                    name: 'Sunday 02-Nov',
                    status: 'Scheduled',
                    schedule: 'Nov 10, 2025 10:00 AM',
                    creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }],
                    children: [
                        {
                            id: 'sun-photos',
                            name: 'Photos',
                            status: 'Scheduled',
                            schedule: 'Nov 10, 2025 10:00 AM',
                            creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }],
                            children: [
                                { id: 'sun-social', name: 'Sunday Social', type: 'gallery', status: 'Scheduled', creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }], content: '180 Photos, 5 Videos', schedule: 'Nov 10, 2025 10:00 AM' },
                            ]
                        }
                    ]
                }
            ]
        };

        let currentPath = ['root'];

        function findNodeByPath(path) {
            let currentNode = galleryData;
            for (let i = 1; i < path.length; i++) {
                if (!currentNode.children) return null;
                currentNode = currentNode.children.find(c => c.id === path[i]);
            }
            return currentNode;
        }

        function renderTreeView(node, parentPath = []) {
            const li = document.createElement('li');
            li.className = 'tree-item';
            li.dataset.id = node.id;

            const currentFullPath = [...parentPath, node.id];
            const hasChildren = node.children && node.children.length > 0;
            const isActive = currentPath.join('/') === currentFullPath.join('/');

            li.innerHTML = `
                <div onclick='selectFolder(${JSON.stringify(currentFullPath)})' class="flex items-center p-1 rounded-md cursor-pointer ${isActive ? 'bg-blue-100' : 'hover:bg-gray-200'}">
                    ${hasChildren ? `<svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>` : '<div class="w-4 h-4 mr-1"></div>'}
                    <span class="font-semibold ${isActive ? 'revelo-blue' : ''}">${node.name}</span>
                </div>
            `;

            if (hasChildren) {
                const ul = document.createElement('ul');
                ul.className = 'tree-content ml-4';
                node.children.forEach(child => {
                    ul.appendChild(renderTreeView(child, currentFullPath));
                });
                li.appendChild(ul);
            }
            return li;
        }

        function renderBreadcrumbs() {
            const nav = document.getElementById('breadcrumb-nav');
            nav.innerHTML = '';
            let tempPath = [];
            currentPath.forEach((nodeId, index) => {
                tempPath.push(nodeId);
                const node = findNodeByPath([...tempPath]);
                const isLast = index === currentPath.length - 1;
                
                const crumbEl = document.createElement(isLast ? 'span' : 'a');
                crumbEl.textContent = node.name;
                
                if (isLast) {
                    crumbEl.className = 'font-semibold text-gray-800';
                } else {
                    const pathSlice = currentPath.slice(0, index + 1);
                    crumbEl.className = 'hover:underline cursor-pointer';
                    crumbEl.onclick = () => selectFolder(pathSlice);
                }
                nav.appendChild(crumbEl);
                if (!isLast) nav.append(' > ');
            });
        }

        function renderCurrentFolderActions() {
            const actionsContainer = document.getElementById('current-folder-actions');
            const currentNode = findNodeByPath(currentPath);
            const statusHtml = getStatusHtml(currentNode.status);

            let creatorsHtml = '';
            if (currentNode.creators && currentNode.creators.length > 0) {
                creatorsHtml += '<div class="flex items-center mt-2"><span class="text-sm font-semibold text-gray-600 mr-2">Creators:</span><div class="flex items-center space-x-2">';
                currentNode.creators.forEach(creator => {
                    creatorsHtml += `<div class="flex items-center"><img class="w-8 h-8 rounded-full border-2 border-white" src="${creator.avatar}" alt="${creator.name}" title="${creator.name}"><span class="text-sm font-semibold text-gray-700 ml-1">${creator.name}</span></div>`;
                });
                creatorsHtml += '</div></div>';
            }

            actionsContainer.innerHTML = `
                <div class="flex flex-col sm:flex-row justify-between sm:items-center">
                    <div class="flex-1 space-y-2">
                        <h3 class="font-bold text-lg revelo-blue">${currentNode.name}</h3>
                        <div class="flex items-center space-x-2">
                            ${statusHtml}
                            ${currentNode.schedule ? `<p class="text-xs text-gray-500">Publishes on ${currentNode.schedule}</p>` : ''}
                        </div>
                        ${creatorsHtml}
                    </div>
                    <div class="mt-4 sm:mt-0">
                        <button onclick="openModal('edit-folder-modal')" class="px-3 py-2 text-sm font-semibold bg-gray-200 text-gray-700 rounded-lg">Edit Folder</button>
                    </div>
                </div>
            `;
        }

        function renderGridView() {
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = '';
            const currentNode = findNodeByPath(currentPath);
            
            // Reset grid classes first
            grid.className = 'grid gap-4';

            if (currentNode.type === 'gallery') {
                grid.classList.add('grid-cols-2', 'sm:grid-cols-3', 'lg:grid-cols-5', 'xl:grid-cols-6');
                renderPhotoGalleryView(grid, currentNode);
                return;
            }
            
            grid.classList.add('grid-cols-1', 'sm:grid-cols-2', 'lg:grid-cols-3', 'xl:grid-cols-4');

            if (!currentNode.children || currentNode.children.length === 0) {
                grid.innerHTML = '<p class="text-gray-500 col-span-full">This folder is empty.</p>';
                return;
            }

            currentNode.children.forEach(child => {
                const fullPath = [...currentPath, child.id];
                if (child.type === 'gallery') {
                    grid.innerHTML += createGalleryCard(child, fullPath);
                } else {
                    grid.innerHTML += createFolderCard(child, fullPath);
                }
            });
        }

        function renderPhotoGalleryView(gridContainer, galleryNode) {
            for (let i = 1; i <= 10; i++) {
                gridContainer.innerHTML += `
                    <div class="aspect-square bg-gray-200 rounded-lg overflow-hidden">
                        <img src="https://placehold.co/400x400/cccccc/ffffff?text=Photo+${i}" onclick="openLightbox(this)" class="w-full h-full object-cover cursor-pointer">
                    </div>
                `;
            }
        }
        
            function getStatusHtml(status) {
            switch(status) {
                case 'Approval Needed': return `<span class="text-xs font-bold bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full whitespace-nowrap">${status}</span>`;
                case 'Public': return `<span class="text-xs font-bold bg-green-100 text-green-800 px-2 py-1 rounded-full whitespace-nowrap">${status}</span>`;
                case 'Scheduled': return `<span class="text-xs font-bold bg-blue-100 text-blue-800 px-2 py-1 rounded-full whitespace-nowrap">${status}</span>`;
                default: return `<span class="text-xs font-bold bg-gray-200 text-gray-800 px-2 py-1 rounded-full whitespace-nowrap">${status}</span>`;
            }
        }

        function createFolderCard(node, path) {
            const statusHtml = getStatusHtml(node.status);
            let creatorsHtml = '';
            if (node.creators && node.creators.length > 0) {
                creatorsHtml += '<div class="flex -space-x-2 mt-2">';
                node.creators.forEach(creator => {
                    creatorsHtml += `<img class="w-6 h-6 rounded-full border-2 border-white" src="${creator.avatar}" alt="${creator.name}" title="${creator.name}">`;
                });
                creatorsHtml += '</div>';
            }

            return `
                <div class="bg-white rounded-lg shadow border flex flex-col justify-between">
                    <div onclick='selectFolder(${JSON.stringify(path)})' class="p-4 flex items-start cursor-pointer">
                        <svg class="w-12 h-12 text-revelo-blue mr-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path></svg>
                        <div class="space-y-1 flex-1 min-w-0">
                            <h3 class="font-bold text-lg revelo-blue truncate">${node.name}</h3>
                            <div class="flex items-center space-x-2">
                                ${statusHtml}
                            </div>
                        </div>
                    </div>
                    <div class="p-4 border-t flex justify-between items-center min-h-[60px]">
                        ${creatorsHtml || '<div></div>'}
                        ${node.schedule ? `<p class="text-xs text-gray-500 text-right">Publishes on<br>${node.schedule}</p>` : ''}
                    </div>
                </div>`;
        }

function createGalleryCard(gallery, path) {
    const statusHtml = getStatusHtml(gallery.status);
    let creatorsHtml = '';
    if (gallery.creators && gallery.creators.length > 0) {
        creatorsHtml += '<div class="flex -space-x-2">';
        gallery.creators.forEach(creator => {
            creatorsHtml += `<img class="w-6 h-6 rounded-full border-2 border-white" src="${creator.avatar}" alt="${creator.name}" title="${creator.name}">`;
        });
        creatorsHtml += '</div>';
    }

    return `
        <div class="bg-white rounded-lg shadow border flex flex-col justify-between">
            <div onclick='selectFolder(${JSON.stringify(path)})' class="cursor-pointer">
                <div class="block relative group"><img src="https://placehold.co/600x400/cccccc/ffffff?text=${gallery.name.replace(' ', '+')}" alt="Gallery cover" class="w-full h-40 object-cover rounded-t-lg"></div>
                <div class="p-4">
                    <div class="flex justify-between items-start"><h3 class="font-bold revelo-blue">${gallery.name}</h3>${statusHtml}</div>
                    <p class="text-sm text-gray-500">by ${gallery.creators.map(c => c.name).join(', ')}</p>
                    <p class="text-sm text-gray-500 mt-2">${gallery.content}</p>
                </div>
            </div>
             <div class="p-4 border-t flex justify-between items-center min-h-[60px]">
                ${creatorsHtml || '<div></div>'}
                ${gallery.schedule ? `<p class="text-xs text-gray-500 text-right">Publishes on<br>${gallery.schedule}</p>` : ''}
            </div>
        </div>`;
}

        function selectFolder(path) {
            currentPath = path;
            updateUI();
        }
        
        function updateUI() {
            const treeContainer = document.getElementById('gallery-tree');
            treeContainer.innerHTML = '';
            treeContainer.appendChild(renderTreeView(galleryData));
            
            let path = [];
            currentPath.forEach(nodeId => {
                path.push(nodeId);
                const treeItem = treeContainer.querySelector(`.tree-item[data-id="${nodeId}"]`);
                if(treeItem) treeItem.classList.add('open');
            });

            renderBreadcrumbs();
            renderCurrentFolderActions();
            renderGridView();
        }

        // --- Modal Logic ---
        const modalBackdrop = document.getElementById('modal-backdrop');
        const allModals = document.querySelectorAll('.modal');
        let modalCurrentNode = null;

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            if (modalId === 'edit-folder-modal') {
                modalCurrentNode = findNodeByPath(currentPath);
                document.getElementById('modal-folder-name').textContent = `Edit Folder: ${modalCurrentNode.name}`;
                document.getElementById('modal-folder-status').value = modalCurrentNode.status;
                renderModalCollaborators();
                toggleScheduledFields();
            }

            modal.classList.remove('hidden');
            modalBackdrop.classList.remove('hidden');
        }

        function closeAllModals() {
            allModals.forEach(modal => modal.classList.add('hidden'));
            modalBackdrop.classList.add('hidden');
        }
        
        function toggleScheduledFields() {
            const status = document.getElementById('modal-folder-status').value;
            const fields = document.getElementById('modal-scheduled-fields');
            fields.classList.toggle('hidden', status !== 'Scheduled');
        }

        function renderModalCollaborators() {
            const list = document.getElementById('modal-collaborators-list');
            list.innerHTML = '';
            modalCurrentNode.creators.forEach(creator => {
                const tag = document.createElement('div');
                tag.className = 'inline-flex items-center bg-gray-100 rounded-full pl-3 pr-1 py-1 text-sm font-semibold text-gray-800 border';
                tag.innerHTML = `
                    <span>${creator.name}</span>
                    <button onclick="removeModalCollaborator('${creator.name}')" class="ml-2 text-red-500 hover:text-red-700 font-bold">&times;</button>
                `;
                list.appendChild(tag);
            });
        }

        function removeModalCollaborator(name) {
            modalCurrentNode.creators = modalCurrentNode.creators.filter(c => c.name !== name);
            renderModalCollaborators();
        }

        function handleModalSearch(event) {
            const query = event.target.value.toLowerCase();
            const suggestionsContainer = document.getElementById('modal-search-suggestions');
            suggestionsContainer.innerHTML = '';
            if (query.length < 2) {
                suggestionsContainer.classList.add('hidden');
                return;
            }
            const mockResults = [{ name: 'Visuals Pro', avatar: '#' }, { name: 'Sha Iborra', avatar: '#' }];
            mockResults.forEach(res => {
                if (res.name.toLowerCase().includes(query)) {
                    const item = document.createElement('div');
                    item.className = 'p-2 hover:bg-gray-100 cursor-pointer';
                    item.textContent = res.name;
                    item.onclick = () => {
                        if (!modalCurrentNode.creators.find(c => c.name === res.name)) {
                            modalCurrentNode.creators.push(res);
                        }
                        renderModalCollaborators();
                        suggestionsContainer.classList.add('hidden');
                        event.target.value = '';
                    };
                    suggestionsContainer.appendChild(item);
                }
            });
            suggestionsContainer.classList.remove('hidden');
        }

        // --- Lightbox Logic ---
        const lightboxImage = document.getElementById('lightbox-image');
        const privacyToggleBtn = document.getElementById('privacy-toggle');
        let currentImageIsPublic = true;

        function openLightbox(imgElement) {
            lightboxImage.src = imgElement.src;
            currentImageIsPublic = true; // Reset to default
            updatePrivacyIcon();
            openModal('lightbox-modal');
        }

        function togglePrivacy() {
            currentImageIsPublic = !currentImageIsPublic;
            updatePrivacyIcon();
        }

        function updatePrivacyIcon() {
            if (currentImageIsPublic) {
                privacyToggleBtn.innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>`;
            } else {
                privacyToggleBtn.innerHTML = `<svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" /></svg>`;
            }
        }
        privacyToggleBtn.addEventListener('click', togglePrivacy);

        // --- Tab Switching Logic ---
        function switchTab(targetId) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('organizer-tab-active'));
            
            document.getElementById(targetId)?.classList.remove('hidden');
            document.querySelector(`[onclick="switchTab('${targetId}')"]`)?.classList.add('organizer-tab-active');
        }

        // --- Modal Simulation Logic ---
        
        function openModal(modalId, buttonElement) {
            const modal = document.getElementById(modalId);
            if (!modal) return;

            // Handle Edit Ticket Modal population and field states
            if (modalId === 'edit-ticket-modal' && buttonElement) {
                const row = buttonElement.closest('tr');
                const cells = row.querySelectorAll('td');
                const statusText = cells[3].querySelector('span').textContent.trim();
                
                document.getElementById('edit-ticket-name').value = cells[0].textContent;
                document.getElementById('edit-ticket-price').value = parseFloat(cells[1].textContent.replace('€', ''));
                document.getElementById('edit-ticket-qty').value = cells[2].textContent.split(' / ')[1];
                document.getElementById('edit-ticket-status').value = statusText;

                const isEditable = statusText === 'Draft';
                document.getElementById('edit-ticket-name').disabled = !isEditable;
                document.getElementById('edit-ticket-price').disabled = !isEditable;
                document.getElementById('edit-ticket-status').disabled = !isEditable;
                document.getElementById('edit-ticket-note').classList.toggle('hidden', isEditable);
                document.getElementById('delete-ticket-btn').classList.toggle('hidden', !isEditable);
            }

            // Handle Edit Rule Modal population and field states
            if (modalId === 'edit-rule-modal' && buttonElement) {
                const row = buttonElement.closest('tr');
                const cells = row.querySelectorAll('td');
                const statusText = cells[3].querySelector('span').textContent.trim();
                const isEditable = statusText === 'Pending';
                
                document.getElementById('edit-rule-desc').value = cells[0].innerText;
                document.getElementById('edit-rule-desc').disabled = !isEditable;
                document.getElementById('edit-rule-note').classList.toggle('hidden', isEditable);
                document.getElementById('delete-rule-btn').classList.toggle('hidden', !isEditable);
                document.getElementById('save-rule-btn').classList.toggle('hidden', !isEditable);
            }
            
            modal.classList.remove('hidden');
            modalBackdrop.classList.remove('hidden');
        }
        function closeAllModals() {
            allModals.forEach(modal => modal.classList.add('hidden'));
            modalBackdrop.classList.add('hidden');
        }

        // --- Add Ticket Logic ---
        function addTicket() {
            const name = document.getElementById('new-ticket-name').value || 'New Ticket';
            const price = parseFloat(document.getElementById('new-ticket-price').value || 0).toFixed(2);
            const qty = document.getElementById('new-ticket-qty').value || 0;
            const status = document.getElementById('new-ticket-status').value;

            const tableBody = document.getElementById('ticket-types-table');
            const newRow = tableBody.insertRow(0); // Insert at the top

            let statusClass, statusText;
            switch(status) {
                case 'Draft':
                    statusClass = 'bg-gray-200 text-gray-800';
                    statusText = 'Draft';
                    break;
                case 'Scheduled':
                    statusClass = 'bg-blue-100 text-blue-800';
                    statusText = 'Scheduled';
                    break;
                case 'Dynamic':
                    statusClass = 'bg-purple-100 text-purple-800';
                    statusText = 'Dynamic';
                    break;
                default:
                    statusClass = 'bg-green-100 text-green-800';
                    statusText = 'On Sale';
            }

            newRow.innerHTML = `
                <td class="px-4 py-3 whitespace-nowrap font-semibold">${name}</td>
                <td class="px-4 py-3">€${price}</td>
                <td class="px-4 py-3">0 / ${qty}</td>
                <td class="px-4 py-3"><span class="text-xs font-semibold ${statusClass} px-2 py-1 rounded-full">${statusText}</span></td>
                <td class="px-4 py-3 text-right"><button onclick="openModal('edit-ticket-modal', this)" class="text-sm font-semibold revelo-blue">Edit</button></td>
            `;
            
            closeAllModals();
        }

        // --- Chart.js Sales Chart ---
        function renderSalesChart() {
            const ctx = document.getElementById('salesChart');
            if (!ctx) return;
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['July', 'August', 'September', 'October', 'November'],
                    datasets: [{
                        label: 'Tickets Sold',
                        data: [50, 120, 200, 280, 350],
                        borderColor: '#213c63',
                        backgroundColor: 'rgba(33, 60, 99, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // --- Page Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            switchTab('overview');
            renderSalesChart();
            updateUI();
        });
    </script>
    <script src="organizer.js" defer></script>
</body>
</html>
    <script src="organizer.js" defer></script>
</body>
</html>